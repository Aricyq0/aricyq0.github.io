<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aricyq0.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文是斯坦福大学 cs193p 公开课程第 04 集的相关笔记。">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford cs193p 04｜MVVM 应用">
<meta property="og:url" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="Serein">
<meta property="og:description" content="本文是斯坦福大学 cs193p 公开课程第 04 集的相关笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_newFile.png">
<meta property="og:image" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_static-let-orange.jpg">
<meta property="og:image" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_biggerEmoji.png">
<meta property="og:image" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_mark.png">
<meta property="article:published_time" content="2024-12-09T03:47:02.000Z">
<meta property="article:modified_time" content="2025-04-01T04:04:40.838Z">
<meta property="article:author" content="Serein">
<meta property="article:tag" content="cs193p">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_newFile.png">

<link rel="canonical" href="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Stanford cs193p 04｜MVVM 应用 | Serein</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Serein</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/aricyq0" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPEG">
      <meta itemprop="name" content="Serein">
      <meta itemprop="description" content="Crazy learning, crazy sharing.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serein">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Stanford cs193p 04｜MVVM 应用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-09 11:47:02" itemprop="dateCreated datePublished" datetime="2024-12-09T11:47:02+08:00">2024-12-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-01 12:04:40" itemprop="dateModified" datetime="2025-04-01T12:04:40+08:00">2025-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/swift/" itemprop="url" rel="index"><span itemprop="name">swift</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文是斯坦福大学 cs193p 公开课程第 04 集的相关笔记。</p>
<span id="more"></span>

<blockquote>
<p>本文主要内容转载于：<a target="_blank" rel="noopener" href="https://nwdan.com/my-learning/stanford-cs193p-4.html">闻者通达的个人博客</a></p>
</blockquote>
<p>cs193p 课程介绍:</p>
<blockquote>
<p>The lectures for the Spring 2023 version of Stanford University’s course CS193p (Developing Applications for iOS using SwiftUI) were given in person but, unfortunately, were not video recorded. However, we did capture the laptop screen of the presentations and demos as well as the associated audio. You can watch these screen captures using the links below. You’ll also find links to supporting material that was distributed to students during the quarter (homework, demo code, etc.).</p>
</blockquote>
<p>cs193p 课程网址: <a target="_blank" rel="noopener" href="https://cs193p.sites.stanford.edu/2023">https://cs193p.sites.stanford.edu/2023</a></p>
<p>为便于梳理，本节笔记包含了第三节课最后 15 分钟、第四节课以及第五节课前四分钟的内容。</p>
<hr>
<h2 id="1-第三节课最后-15-分钟"><a href="#1-第三节课最后-15-分钟" class="headerlink" title="1. 第三节课最后 15 分钟"></a>1. 第三节课最后 15 分钟</h2><h3 id="1-1-整理代码"><a href="#1-1-整理代码" class="headerlink" title="1.1 整理代码"></a>1.1 整理代码</h3><p>我们在应用 MVVM 设计思想前需要清理一下代码。</p>
<p>移除以下部分：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> <span class="keyword">var</span> cardCount: <span class="type">Int</span> <span class="operator">=</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cardCountAdjsters: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">HStack</span> &#123;</span><br><span class="line">        cardRemover</span><br><span class="line">        <span class="type">Spacer</span>()</span><br><span class="line">        cardAdder</span><br><span class="line">    &#125;</span><br><span class="line">    .imageScale(.large)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">cardCountAdjsters</span>(<span class="params">by</span> <span class="params">offset</span>: <span class="type">Int</span>, <span class="params">symbol</span>: <span class="type">String</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(action: &#123;</span><br><span class="line">        cardCount <span class="operator">+=</span> offset</span><br><span class="line">    &#125;, label: &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: symbol)</span><br><span class="line">    &#125;)</span><br><span class="line">    .disabled(cardCount <span class="operator">+</span> offset <span class="operator">&lt;</span> <span class="number">1</span> <span class="operator">||</span> cardCount <span class="operator">+</span> offset <span class="operator">&gt;</span> emojis.count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cardRemover: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cardCountAdjsters(by: <span class="operator">-</span><span class="number">1</span>, symbol: <span class="string">&quot;rectangle.stack.badge.minus.fill&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cardAdder: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cardCountAdjsters(by: <span class="number">1</span>, symbol: <span class="string">&quot;rectangle.stack.badge.plus.fill&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改成以下部分：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">...</span></span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">ScrollView</span> &#123;</span><br><span class="line">                cards</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            cardCountAdjsters</span><br><span class="line">        &#125;</span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="comment">// change to</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            cards</span><br><span class="line">        &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">            <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span>cardCount, id: \.<span class="keyword">self</span>) &#123; index <span class="keyword">in</span></span><br><span class="line"><span class="comment">// change to</span></span><br><span class="line">            <span class="type">ForEach</span>(emojis.indices, id: \.<span class="keyword">self</span>) &#123; index <span class="keyword">in</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-新建一个-Model-文件"><a href="#1-2-新建一个-Model-文件" class="headerlink" title="1.2 新建一个 Model 文件"></a>1.2 新建一个 Model 文件</h3><p><code>File</code> -&gt; <code>New</code> -&gt; <code>File</code> -&gt; <code>Swift File</code>, 并将文件命名为 MemorizeGame</p>
<p><img src="/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_newFile.png"></p>
<p><strong>实现（写）一个 MemorizeGame (Model):</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MemoryGame</span>&lt;<span class="type">CardContent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> cards: <span class="type">Array</span>&lt;<span class="type">Card</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="params">card</span>: <span class="type">Card</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Card</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> isFaceUp: <span class="type">Bool</span></span><br><span class="line">        <span class="keyword">var</span> isMatched: <span class="type">Bool</span></span><br><span class="line">        <span class="keyword">var</span> content: <span class="type">CardContent</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-新建一个-ViewModel-文件"><a href="#1-3-新建一个-ViewModel-文件" class="headerlink" title="1.3 新建一个 ViewModel 文件"></a>1.3 新建一个 ViewModel 文件</h3><p><code>File</code> -&gt; <code>New</code> -&gt; <code>File</code> -&gt; <code>Swift File</code>, then named as EmojiMemoryGame</p>
<p><strong>实现（写）一个 MemorizeGame (ViewModel):</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> model: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-第四节课"><a href="#2-第四节课" class="headerlink" title="2. 第四节课"></a>2. 第四节课</h2><h3 id="2-1-访问控制：实现由部分分离转为全部分离"><a href="#2-1-访问控制：实现由部分分离转为全部分离" class="headerlink" title="2.1 访问控制：实现由部分分离转为全部分离"></a>2.1 访问控制：实现由部分分离转为全部分离</h3><h4 id="2-1-1-部分分离"><a href="#2-1-1-部分分离" class="headerlink" title="2.1.1 部分分离"></a>2.1.1 部分分离</h4><p>我们来看看 MVVM 文件:</p>
<p><strong>View:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContentView.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> viewModel: <span class="type">EmojiMemoryGame</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> emojis <span class="operator">=</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>]</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Model:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MemoryGame</span>&lt;<span class="type">CardContent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> cards: <span class="type">Array</span>&lt;<span class="type">Card</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="params">card</span>: <span class="type">Card</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ViewModel:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> model: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于我们现在仍然可以在 <code>View</code> 中通过 <code>viewModel.model.xxx</code> 直接从 View 访问 Model，因此这是部分分离模式。</p>
<h4 id="2-1-2-完全分离"><a href="#2-1-2-完全分离" class="headerlink" title="2.1.2 完全分离"></a>2.1.2 完全分离</h4><p>如果我们想避免 View 直接访问 Model，我们需要使用关键字 <code>private</code> 来实现。这被称为完全分离。</p>
<p>修改 <strong>ViewModel</strong>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那我们现在如何访问 model 呢？我们需要修改 ViewModel 让它可以被访问。</p>
<p>这是修改过后的 <strong>ViewModel</strong>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">	<span class="comment">// private 使得 View 无法直接访问 model；这里意味着在 ViewModel 中使用 Model</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在 ViewModel 中访问 model 中的数据 cards</span></span><br><span class="line">    <span class="keyword">var</span> cards: <span class="type">Array</span>&lt;<span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> model.cards</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在 ViewModel 中实现对 model 中的 card 的 choose 操作</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="params">card</span>: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span>) &#123;</span><br><span class="line">        model.choose(card: card)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="private-set"><a href="#private-set" class="headerlink" title="private(set)"></a>private(set)</h5><p>对应的在 <code>Model</code> 中应该怎么修改呢？</p>
<p><code>private(set)</code> 关键字允许其他函数只能读，但不可以修改。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemoryGame.swift</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MemoryGame</span>&lt;<span class="type">CardContent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> cards: <span class="type">Array</span>&lt;<span class="type">Card</span>&gt;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-ViewModel-方法补充和-Model-对应修改"><a href="#2-2-ViewModel-方法补充和-Model-对应修改" class="headerlink" title="2.2 ViewModel 方法补充和 Model 对应修改"></a>2.2 ViewModel 方法补充和 Model 对应修改</h3><h4 id="2-2-1-Model-的-choose-函数声明和-ViewModel-的-choose-函数声明调用"><a href="#2-2-1-Model-的-choose-函数声明和-ViewModel-的-choose-函数声明调用" class="headerlink" title="2.2.1 Model 的 choose 函数声明和 ViewModel 的 choose 函数声明调用"></a>2.2.1 <code>Model</code> 的 choose 函数声明和 <code>ViewModel</code> 的 choose 函数声明调用</h4><h5 id="忽略函数标签-No-External-Name"><a href="#忽略函数标签-No-External-Name" class="headerlink" title="忽略函数标签 (No External Name)"></a>忽略函数标签 (No External Name)</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemoryGame.swift</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="keyword">_</span> <span class="params">card</span>: <span class="type">Card</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="keyword">_</span> <span class="params">card</span>: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span>) &#123;</span><br><span class="line">        model.choose(card)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>choose</code>函数在被外部调用后不需要有外部称呼。然而，我们在一些情况下不需要省略外部称呼：</p>
<ol>
<li>数据类型是字符串，整数，或不确定的。</li>
<li>添加外部称呼可以增加代码的可读性。</li>
</ol>
<h4 id="2-2-2-Model-结构体的初始化器和-ViewModel-类初始化"><a href="#2-2-2-Model-结构体的初始化器和-ViewModel-类初始化" class="headerlink" title="2.2.2 Model 结构体的初始化器和 ViewModel 类初始化"></a>2.2.2 <code>Model</code> 结构体的初始化器和 <code>ViewModel</code> 类初始化</h4><p>类初始值设定项没有参数，并且仅当所有变量都有默认值时才起作用。 我们接下来开始写 <strong>ViewModel</strong> (EmojiMemoryGame.swift) 初始化函数。</p>
<p>另外，我们想要通过用 <code>numberOfPairsOfCards</code> 和 <code>cardContentFactory</code> 来初始化 <strong>Model</strong> (MemoryGame.swift)。因此我们先需要自定义 <strong>Model</strong> 的初始化函数。（这两个参数分别代表卡片数，以及通过卡片索引获取卡片内容的函数）</p>
<h5 id="Model-初始化器"><a href="#Model-初始化器" class="headerlink" title="Model 初始化器"></a><code>Model</code> 初始化器</h5><h6 id="1-For-循环"><a href="#1-For-循环" class="headerlink" title="1. For 循环"></a><strong>1. For 循环</strong></h6><p>我们想要对每张原卡片，卡片组中都会有两张存在。我们可以使用 <code>_</code> 来忽略循环的索引。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemoryGame.swift</span></span><br><span class="line"><span class="keyword">for</span> pairIndex <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numberOfPairsOfCards &#123;</span><br><span class="line">    cards.append(<span class="type">XXXX</span>)</span><br><span class="line">    cards.append(<span class="type">XXXX</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Use _ to ignore the pairIndex</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numberOfPairsOfCards &#123;</span><br><span class="line">    cards.append(<span class="type">XXXX</span>)</span><br><span class="line">    cards.append(<span class="type">XXXX</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>XXXX</code> 代表的是 <code>cardContentFactory</code> 通过 <code>pairIndex</code> 索引获取到的卡片内容。下边会讲如何使用闭包来实现该函数。</p>
<h6 id="2-闭包语法"><a href="#2-闭包语法" class="headerlink" title="2. 闭包语法"></a><strong>2. 闭包语法</strong></h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MemoryGame</span>&lt;<span class="type">CardContent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> cards: <span class="type">Array</span>&lt;<span class="type">Card</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">numberOfPairsOfCards</span>: <span class="type">Int</span>, <span class="params">cardContentFactory</span>: (<span class="type">Int</span>) -&gt; <span class="type">CardContent</span>) &#123;</span><br><span class="line">        cards <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add numberOfParisOfCards x 2 cards</span></span><br><span class="line">        <span class="keyword">for</span> pairIndex <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numberOfPairsOfCards &#123;</span><br><span class="line">            <span class="keyword">let</span> content <span class="operator">=</span> cardContentFactory(pairIndex)</span><br><span class="line">            cards.append(<span class="type">Card</span>(content: content))</span><br><span class="line">            cards.append(<span class="type">Card</span>(content: content))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="在-ViewModel-中初始化-Model-变量"><a href="#在-ViewModel-中初始化-Model-变量" class="headerlink" title="在 ViewModel 中初始化 Model 变量"></a>在 <code>ViewModel</code> 中初始化 <code>Model</code> 变量</h5><p>接下来，我们需要初始化 <code>model</code> 变量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">func</span> <span class="title function_">createCardContent</span>(<span class="params">forPairAtIndex</span> <span class="params">index</span>: <span class="type">Int</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(</span><br><span class="line">        numberOfPairsOfCards: <span class="number">4</span>,</span><br><span class="line">        cardContentFactory: createCardContent</span><br><span class="line">    )</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MemoryGame</code> 初始化器的第二个参数需要传入一个接受整数并返回字符串的函数。<code>createCardContent</code> 是一个接受整数并返回字符串的函数，因此我们可以将它传入。</p>
<p>我们可以使用<strong>闭包语法</strong>让它更变得更简洁一些：将 <code>createCardContent</code> 函数内容移入类初始化参数 <code>cardContentFactory</code> 后，并将函数大括号 <code>&#123;&#125;</code> 替换为 <code>in</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(</span><br><span class="line">        numberOfPairsOfCards: <span class="number">4</span>,</span><br><span class="line">        cardContentFactory: &#123; (index: <span class="type">Int</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][index]</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"><span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于<strong>类型推断</strong>，输入参数为 <code>Int</code> 类型，我们可以省略类型声明，如下：</p>
<blockquote>
<p>可按住 option，并 click 查看 <code>Index</code> 推断的类型为 <code>Int</code>。类型推断在第二节有说明：<a href="/2024/11/21/Stanford-cs193p-02%EF%BD%9CMore-SwiftUI/" title="Stanford cs193p 02 | More SwiftUI">Stanford cs193p 02 | More SwiftUI</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(</span><br><span class="line">        numberOfPairsOfCards: <span class="number">4</span>,</span><br><span class="line">        cardContentFactory: &#123; index <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][index]</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"><span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时，由于 <code>cardContentFactory</code> 是这个函数的最后一个参数，我们可以使用<strong>尾随闭包</strong>：</p>
<blockquote>
<p>尾随闭包在第二节笔记中有说明：<a href="/2024/11/21/Stanford-cs193p-02%EF%BD%9CMore-SwiftUI/" title="Stanford cs193p 02 | More SwiftUI">Stanford cs193p 02 | More SwiftUI</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][index]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="1-0"><a href="#1-0" class="headerlink" title="1. $0"></a><strong>1. $0</strong></h6><p>$0 是一个用于表示第一个参数的特殊占位符，这里可使用 <code>$0</code> 替代 <code>index</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][index]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="comment">// If we use $0</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; <span class="variable">$0</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>][<span class="variable">$0</span>]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<h6 id="2-静态变量和函数"><a href="#2-静态变量和函数" class="headerlink" title="2. 静态变量和函数"></a><strong>2. 静态变量和函数</strong></h6><p>倘若，我们还想简化这个类的初始化，想将这个表情数组提取为一个变量 <code>emojis</code> 使用， 以下代码 XCode 会报错：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> emojis <span class="operator">=</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>错误信息是 “Cannot use instance member ‘emojis’ within property initializer; property initializers run before ‘self’ is available”. <code>emojis</code> 和 <code>model</code> 被称为 property initializer。<strong>由于 property initialized 的运行顺序是不确定的 (不是源代码的顺序)，我们可能会先初始化 model，但此时 emojis 还未被初始化，因此不能使用一个初始化变量去初始化另一个。</strong></p>
<p>那么怎么解决呢？</p>
<p><strong>第一种方法：将 emojis 设置为一个全局变量</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">let</span> emojis <span class="operator">=</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// EmojiMemoryGame.emojis[pairIndex]</span></span><br><span class="line">        <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>但这会污染命名空间，可能会与其他变量或常量发生命名冲突，难以调试。而且全局变量可以在任意位置被修改，<code>View</code> 和 <code>Model</code> 中都可以修改，导致代码很难理解，因为变量的状态可能在不知情的情况下被修改。</p>
<p>所以为了使它具有可封装性，还是得将它放回类 <code>class</code> 中。</p>
<p><strong>第二种方法：使用关键字 <code>static</code> 来解决</strong></p>
<p>我们可以使用关键字 <code>static</code> 来解决这个问题。这个关键字可以让 <code>emojis</code> 变为全局变量 (事实上被称为 type variable) 但仅限于这个类的内部访问。而且全局变量会被优先初始化，不用担心初始化变量的顺序问题。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> emojis <span class="operator">=</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">EmojiMemoryGame</span>.emojis[pairIndex]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p><code>private</code> 则可以讲这个变量限制在 <code>class</code> 内部使用，外部无法直接访问或修改。此时不再需要 <code>EmojiMemoryGame</code> 来调用 <code>emojis</code>，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">let</span> emojis <span class="operator">=</span> [<span class="string">&quot;👻&quot;</span>, <span class="string">&quot;🎃&quot;</span>, <span class="string">&quot;🕷️&quot;</span>, <span class="string">&quot;🎉&quot;</span>,<span class="string">&quot;😄&quot;</span>, <span class="string">&quot;😎&quot;</span>, <span class="string">&quot;💩&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// EmojiMemoryGame.emojis[pairIndex]</span></span><br><span class="line">        <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：现在 <code>emojis</code> 的全名其实是 <code>EmojiMemoryGame.emojis</code>.</p>
</blockquote>
<p>我们现在将上面的变量变成一个函数，然后存在 model 里：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> createMemoryGame()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">createMemoryGame</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>会有一堆错误信息。</p>
<p>我们需要将函数标记为 <code>static</code> 并增加返回类型。<strong>Swift 是不可以推断返回类型的。</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">createMemoryGame</span>() -&gt; <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> createMemoryGame()</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<h6 id="3-“-thing”"><a href="#3-“-thing”" class="headerlink" title="3. “.thing”"></a><strong>3. “.thing”</strong></h6><blockquote>
<p>此处 <code>.thing</code> 是补充说明 <code>privat static</code>，并不涉及 <code>ViewModel</code> 和 <code>Model</code> 的实现</p>
</blockquote>
<p>当我们看到 “.一个东西”时, 它只有可能是静态变量或者枚举类型 <code>enum</code>。如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ContentView.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">85</span>))]) &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br><span class="line">.foregroundColor(.orange)</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>我们在代码中发现了一个 <code>.orange</code> ，它实际与 <code>Color.orange</code> 的含义完全相同。我们再打开 Swift 的开发者文档：<br><img src="/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_static-let-orange.jpg"></p>
<p><code>.orange</code>、<code>.pink</code> 和 <code>.purple</code> 都是静态 <code>static</code> 变量。</p>
<h4 id="2-2-3-问题解决：数组不能超出索引"><a href="#2-2-3-问题解决：数组不能超出索引" class="headerlink" title="2.2.3 问题解决：数组不能超出索引"></a>2.2.3 问题解决：数组不能超出索引</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">createMemoryGame</span>() -&gt; <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>我们访问数组时不能超出索引，因此需要新增一些逻辑。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">createMemoryGame</span>() -&gt; <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">MemoryGame</span>(numberOfPairsOfCards: <span class="number">4</span>) &#123; pairIndex <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> emojis.indices.contains(pairIndex) &#123;</span><br><span class="line">                <span class="keyword">return</span> emojis[pairIndex]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;⁉️&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>我们同时希望有至少 4 张卡：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MemorizeGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">numberOfPairsOfCards</span>: <span class="type">Int</span>, <span class="params">cardContentFactory</span>: (<span class="type">Int</span>) -&gt; <span class="type">CardContent</span>) &#123;</span><br><span class="line">        cards <span class="operator">=</span> []</span><br><span class="line">        <span class="comment">// add numberOfParisOfCards x 2 cards</span></span><br><span class="line">        <span class="keyword">for</span> pairIndex <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="built_in">max</span>(<span class="number">2</span>, numberOfPairsOfCards) &#123;</span><br><span class="line">            <span class="keyword">let</span> content <span class="operator">=</span> cardContentFactory(pairIndex)</span><br><span class="line">            cards.append(<span class="type">Card</span>(content: content))</span><br><span class="line">            cards.append(<span class="type">Card</span>(content: content))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-在-View-中使用-ViewModel"><a href="#2-3-在-View-中使用-ViewModel" class="headerlink" title="2.3 在 View 中使用 ViewModel"></a>2.3 在 View 中使用 ViewModel</h3><blockquote>
<p>注意: 我们将 ContentView.swift 文件重命名为了 EmojiMemoryGameView.swift</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">var</span> cards: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">85</span>))]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(emojis.indices, id: \.<span class="keyword">self</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">                <span class="type">CardView</span>(content: emojis[index])</span><br><span class="line">                    .aspectRatio(<span class="number">2</span><span class="operator">/</span><span class="number">3</span>, contentMode: .fit)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .foregroundColor(.orange)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CardView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> content: <span class="type">String</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> isFaceUp <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> base <span class="operator">=</span> <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">12</span>)</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                base.fill(.white)</span><br><span class="line">                base.strokeBorder(lineWidth: <span class="number">2</span>)</span><br><span class="line">                <span class="type">Text</span>(content).font(.largeTitle)</span><br><span class="line">            &#125;</span><br><span class="line">            .opacity(isFaceUp <span class="operator">?</span> <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">            base.fill().opacity(isFaceUp <span class="operator">?</span> <span class="number">0</span> : <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .onTapGesture &#123;</span><br><span class="line">            isFaceUp.toggle()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>现在需要循环卡片。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">    <span class="keyword">var</span> cards: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">85</span>))]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(viewModel.cards.indices, id: \.<span class="keyword">self</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">                <span class="type">CardView</span>(card: viewModel.cards[index])</span><br><span class="line">                    .aspectRatio(<span class="number">2</span><span class="operator">/</span><span class="number">3</span>, contentMode: .fit)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .foregroundColor(.orange)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CardView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> card: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> base <span class="operator">=</span> <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">12</span>)</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                base.fill(.white)</span><br><span class="line">                base.strokeBorder(lineWidth: <span class="number">2</span>)</span><br><span class="line">                <span class="type">Text</span>(card.content).font(.largeTitle)</span><br><span class="line">            &#125;</span><br><span class="line">            .opacity(card.isFaceUp <span class="operator">?</span> <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">            base.fill().opacity(card.isFaceUp <span class="operator">?</span> <span class="number">0</span> : <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>如果我们现在想要查看卡片的正面，只需要更改 Model 即可。（<code>MemorizeGame.swift</code> 文件）</p>
<h4 id="2-3-1-CardView-Struct-优化"><a href="#2-3-1-CardView-Struct-优化" class="headerlink" title="2.3.1 CardView Struct 优化"></a>2.3.1 CardView Struct 优化</h4><p>我们还可以优化一下 CardView。调用时需要写 <code>card:</code> 很麻烦：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CardView</span>(card: viewModel.cards[index])</span><br></pre></td></tr></table></figure>

<p>我们可以创建自己的初始化函数<code>init</code>忽略函数标签。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">    <span class="keyword">var</span> cards: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">85</span>))]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(viewModel.cards.indices, id: \.<span class="keyword">self</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">                <span class="type">CardView</span>(viewModel.cards[index])</span><br><span class="line">                    .aspectRatio(<span class="number">2</span><span class="operator">/</span><span class="number">3</span>, contentMode: .fit)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .foregroundColor(.orange)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CardView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> card: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">card</span>: <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.card <span class="operator">=</span> card</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-放大-Emoji"><a href="#2-3-2-放大-Emoji" class="headerlink" title="2.3.2 放大 Emoji"></a>2.3.2 放大 Emoji</h4><p><img src="/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_biggerEmoji.png"></p>
<h3 id="2-4-View-和-ViewModel-关联优化"><a href="#2-4-View-和-ViewModel-关联优化" class="headerlink" title="2.4 View 和 ViewModel 关联优化"></a>2.4 <code>View</code> 和 <code>ViewModel</code> 关联优化</h3><h4 id="2-4-1-MARK-Intents"><a href="#2-4-1-MARK-Intents" class="headerlink" title="2.4.1 MARK: - Intents"></a>2.4.1 <code>MARK: - Intents</code></h4><p>当我们使用 <code>MAKR: - XXX</code> 时， <code>-</code> 可以在 Swift 中看起来有一条线一样，如下图。</p>
<p><img src="/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/cs193p04_mark.png"></p>
<h4 id="2-4-2-洗牌"><a href="#2-4-2-洗牌" class="headerlink" title="2.4.2 洗牌"></a>2.4.2 洗牌</h4><h5 id="修改-View-和-ViewModel"><a href="#修改-View-和-ViewModel" class="headerlink" title="修改 View 和 ViewModel"></a>修改 View 和 ViewModel</h5><p>实现（修改） ViewModel:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span> &#123;</span><br><span class="line">        <span class="operator">...</span></span><br><span class="line">      <span class="operator">...</span></span><br><span class="line">    <span class="comment">// MARK: - Intents</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">shuffle</span>() &#123;</span><br><span class="line">        model.shuffle()</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="operator">...</span></span><br><span class="line">      <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现（修改）View:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">ScrollView</span> &#123;</span><br><span class="line">                cards</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Shuffle&quot;</span>) &#123;</span><br><span class="line">                viewModel.shuffle()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<h5 id="mutating"><a href="#mutating" class="headerlink" title="mutating"></a>mutating</h5><p>我们需要让 Model 支持洗牌的操作。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MemorizeGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">shuffle</span>() &#123;</span><br><span class="line">        cards.shuffle()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>但是，<code>self (Model)</code> 是不可更改的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MemorizeGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">shuffle</span>() &#123;</span><br><span class="line">        cards.shuffle()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>任何函数需要修改 Model 必须要被标记 <strong>mutating</strong> 关键字，因为这会造成写时复制（copy on write）。</p>
<h5 id="Reactive-UI"><a href="#Reactive-UI" class="headerlink" title="Reactive UI"></a>Reactive UI</h5><p><code>@ObservableObject</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGame.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmojiMemoryGame</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">      <span class="meta">@Published</span> <span class="keyword">private</span> <span class="keyword">var</span> model <span class="operator">=</span> createMemoryGame()</span><br><span class="line">      <span class="operator">...</span></span><br><span class="line">    <span class="comment">// MARK: - Intents</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">shuffle</span>() &#123;</span><br><span class="line">        model.shuffle()</span><br><span class="line">        objectWillChange.send()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>objectWillChange.send()</code> 会通知 UI (View)，有些东西将要变了。 <code>@Published</code> 则在一些东西变动后, 说一些东西已经变了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">EmojiMemoryGame</span> <span class="operator">=</span> <span class="type">EmojiMemoryGame</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">ScrollView</span> &#123;</span><br><span class="line">                cards</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Shuffle&quot;</span>) &#123;</span><br><span class="line">                viewModel.shuffle()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们也需要给我们的 <code>viewModel</code> 变量添加 <code>@ObservedObject</code> 。此处 <code>@ObservedObject</code> 的作用会观察 <code>EmojiMemoryGame</code> 中的 <code>@Published</code> 变量变化，如果发生变化了，则会重新渲染 UI。</p>
<p><strong>重要提示：</strong> 有一个 <code>@ObservedObject</code> 然后赋值一些东西是<strong>非常不好</strong>的习惯。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">EmojiMemoryGame</span> <span class="operator">=</span> <span class="type">EmojiMemoryGame</span>()</span><br></pre></td></tr></table></figure>

<p><strong>正确</strong> 的方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGameView.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> viewModel: <span class="type">EmojiMemoryGame</span></span><br><span class="line">        <span class="operator">...</span></span><br><span class="line">        <span class="operator">...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="type">Preview</span> &#123;</span><br><span class="line">	<span class="comment">//此处初始化 viewModel 变量，来进行预览</span></span><br><span class="line">    <span class="type">EmojiMemoryGameView</span>(viewModel: <span class="type">EmojiMemoryGame</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还需要修改 App：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MemorizeApp.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MemorizeApp</span>: <span class="title class_ inherited__">App</span> &#123;</span><br><span class="line">	<span class="comment">// 初始化 viewModel 对象</span></span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">var</span> game <span class="operator">=</span> <span class="type">EmojiMemoryGame</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">EmojiMemoryGameView</span>(viewModel: game)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@StateObject</code> 意思是你不能和其他 <code>View</code> 共享这个对象。</p>
<h5 id="续第五节课：-ObservedObject-和-StateObject-区别"><a href="#续第五节课：-ObservedObject-和-StateObject-区别" class="headerlink" title="续第五节课：@ObservedObject 和 @StateObject 区别"></a>续第五节课：<code>@ObservedObject</code> 和 <code>@StateObject</code> 区别</h5><p><strong>1. 示例（非课件内容）</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> value <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ParentView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> counter <span class="operator">=</span> <span class="type">Counter</span>() <span class="comment">// 由父视图负责创建和管理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ChildView</span>(counter: counter) <span class="comment">// 将 ObservableObject 传递给子视图</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ChildView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@ObservedObject</span> <span class="keyword">var</span> counter: <span class="type">Counter</span> <span class="comment">// 观察父视图传递过来的实例</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Counter: <span class="subst">\(counter.value)</span>&quot;</span>)</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Increment&quot;</span>) &#123;</span><br><span class="line">                counter.value <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>ParentView</code></strong> 创建并管理 <code>Counter</code> 的生命周期。</li>
<li><strong><code>ChildView</code></strong> 使用 <code>@ObservedObject</code> 观察传入的 <code>Counter</code> 实例，但不负责管理其生命周期。</li>
</ul>
<p>使用 <code>@StateObject</code> 和 <code>@ObservedObject</code> 的核心在于对<strong>生命周期的理解</strong>，确保在合适的上下文中管理和观察数据。</p>
<p><strong>2. 总结</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th><code>@ObservedObject</code></th>
<th><code>@StateObject</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>负责实例创建</strong></td>
<td>否：只观察传入的 <code>ObservableObject</code></td>
<td>是：负责创建并管理 <code>ObservableObject</code> 的生命周期</td>
</tr>
<tr>
<td><strong>生命周期管理</strong></td>
<td>不管理，依赖于外部实例的生命周期</td>
<td>自动管理，当视图销毁时，<code>ObservableObject</code> 也销毁</td>
</tr>
<tr>
<td><strong>初始化时机</strong></td>
<td>外部传入实例，必须在外部已创建</td>
<td>仅在视图首次初始化时创建一次</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>子视图：观察由父视图传递的 <code>ObservableObject</code> 实例</td>
<td>父视图：创建并管理自己的 <code>ObservableObject</code> 实例</td>
</tr>
<tr>
<td><strong>重复渲染</strong></td>
<td>每次视图刷新时，观察相同的实例</td>
<td>不会在视图刷新时重复创建 <code>ObservableObject</code></td>
</tr>
</tbody></table>
<ul>
<li><code>@StateObject</code> 适用于当前视图需要自己创建并管理 <code>ObservableObject</code> 实例的生命周期，常用于父视图或独立视图。</li>
<li><code>@ObservedObject</code>适用于观察由外部传递的 <code>ObservableObject</code>，常用于子视图。</li>
<li><code>@ObservedObject</code> 和 <code>@StateObject</code> 都是用于观察 <code>ObservableObject</code> 的属性包装器，但它们有不同的使用场景和生命周期管理方式。</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>欣赏此文？求鼓励，求支持！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Serein 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Serein 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
      <div>
     
       
<div class="my_post_copyright">
  <div style="text-align:center;color: #ccc;font-size:14px;">------ 版权声明 ------</div>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <p><span>原始链接:</span><a href="/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/" title="Stanford cs193p 04｜MVVM 应用">https://aricyq0.github.io/2024/12/09/Stanford-cs193p-04｜MVVM-应用/</a>
    <button class="copy-button" style="cursor: pointer; margin-left: 6px; border: none; background: none;" title="点击复制文章链接">
      <i class="fa fa-clipboard" aria-label="复制"></i>
    </button>
    <span class="copy-success" style="margin-left: 5px; display: none; color: #999; font-size: 14px;">复制成功</span>
  </p>
  <p><span style="margin-right: 4px;">版权申明:</span>本博客所有文章除特别声明外，均采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a>许可协议。转载请保留原文链接及作者。</p>  
</div>
<script> 
  document.addEventListener('DOMContentLoaded', function() {
    var clipboard = new ClipboardJS('.copy-button', {
      text: function() {
        return window.location.origin + '/2024/12/09/Stanford-cs193p-04%EF%BD%9CMVVM-%E5%BA%94%E7%94%A8/';
      }
    });
    
    clipboard.on('success', function(e) {
      var successTip = document.querySelector('.copy-success');
      successTip.style.display = 'inline';
      setTimeout(function() {
        successTip.style.display = 'none';
      }, 1000);
    });
  });
</script>

     
</div>
          
          <div class="post-tags">
              <a href="/tags/cs193p/" rel="tag"><i class="fa fa-tag"></i> cs193p</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/12/06/Stanford-cs193p-03%EF%BD%9CMVVM/" rel="prev" title="Stanford cs193p 03｜MVVM">
      <i class="fa fa-chevron-left"></i> Stanford cs193p 03｜MVVM
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/12/20/Stanford-cs193p-05%EF%BD%9CProtocol-Enum-Optional/" rel="next" title="Stanford cs193p 05 | Protocol Enum Optional">
      Stanford cs193p 05 | Protocol Enum Optional <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%89%E8%8A%82%E8%AF%BE%E6%9C%80%E5%90%8E-15-%E5%88%86%E9%92%9F"><span class="nav-text">1. 第三节课最后 15 分钟</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%95%B4%E7%90%86%E4%BB%A3%E7%A0%81"><span class="nav-text">1.1 整理代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA-Model-%E6%96%87%E4%BB%B6"><span class="nav-text">1.2 新建一个 Model 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA-ViewModel-%E6%96%87%E4%BB%B6"><span class="nav-text">1.3 新建一个 ViewModel 文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%AC%AC%E5%9B%9B%E8%8A%82%E8%AF%BE"><span class="nav-text">2. 第四节课</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%94%B1%E9%83%A8%E5%88%86%E5%88%86%E7%A6%BB%E8%BD%AC%E4%B8%BA%E5%85%A8%E9%83%A8%E5%88%86%E7%A6%BB"><span class="nav-text">2.1 访问控制：实现由部分分离转为全部分离</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E9%83%A8%E5%88%86%E5%88%86%E7%A6%BB"><span class="nav-text">2.1.1 部分分离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-%E5%AE%8C%E5%85%A8%E5%88%86%E7%A6%BB"><span class="nav-text">2.1.2 完全分离</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#private-set"><span class="nav-text">private(set)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-ViewModel-%E6%96%B9%E6%B3%95%E8%A1%A5%E5%85%85%E5%92%8C-Model-%E5%AF%B9%E5%BA%94%E4%BF%AE%E6%94%B9"><span class="nav-text">2.2 ViewModel 方法补充和 Model 对应修改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-Model-%E7%9A%84-choose-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E5%92%8C-ViewModel-%E7%9A%84-choose-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E8%B0%83%E7%94%A8"><span class="nav-text">2.2.1 Model 的 choose 函数声明和 ViewModel 的 choose 函数声明调用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BF%BD%E7%95%A5%E5%87%BD%E6%95%B0%E6%A0%87%E7%AD%BE-No-External-Name"><span class="nav-text">忽略函数标签 (No External Name)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-Model-%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%99%A8%E5%92%8C-ViewModel-%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">2.2.2 Model 结构体的初始化器和 ViewModel 类初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Model-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%99%A8"><span class="nav-text">Model 初始化器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-For-%E5%BE%AA%E7%8E%AF"><span class="nav-text">1. For 循环</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-%E9%97%AD%E5%8C%85%E8%AF%AD%E6%B3%95"><span class="nav-text">2. 闭包语法</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-ViewModel-%E4%B8%AD%E5%88%9D%E5%A7%8B%E5%8C%96-Model-%E5%8F%98%E9%87%8F"><span class="nav-text">在 ViewModel 中初始化 Model 变量</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-0"><span class="nav-text">1. $0</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E5%87%BD%E6%95%B0"><span class="nav-text">2. 静态变量和函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-%E2%80%9C-thing%E2%80%9D"><span class="nav-text">3. “.thing”</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%EF%BC%9A%E6%95%B0%E7%BB%84%E4%B8%8D%E8%83%BD%E8%B6%85%E5%87%BA%E7%B4%A2%E5%BC%95"><span class="nav-text">2.2.3 问题解决：数组不能超出索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%9C%A8-View-%E4%B8%AD%E4%BD%BF%E7%94%A8-ViewModel"><span class="nav-text">2.3 在 View 中使用 ViewModel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-CardView-Struct-%E4%BC%98%E5%8C%96"><span class="nav-text">2.3.1 CardView Struct 优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-%E6%94%BE%E5%A4%A7-Emoji"><span class="nav-text">2.3.2 放大 Emoji</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-View-%E5%92%8C-ViewModel-%E5%85%B3%E8%81%94%E4%BC%98%E5%8C%96"><span class="nav-text">2.4 View 和 ViewModel 关联优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-MARK-Intents"><span class="nav-text">2.4.1 MARK: - Intents</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-%E6%B4%97%E7%89%8C"><span class="nav-text">2.4.2 洗牌</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-View-%E5%92%8C-ViewModel"><span class="nav-text">修改 View 和 ViewModel</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#mutating"><span class="nav-text">mutating</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Reactive-UI"><span class="nav-text">Reactive UI</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%AD%E7%AC%AC%E4%BA%94%E8%8A%82%E8%AF%BE%EF%BC%9A-ObservedObject-%E5%92%8C-StateObject-%E5%8C%BA%E5%88%AB"><span class="nav-text">续第五节课：@ObservedObject 和 @StateObject 区别</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Serein"
      src="/uploads/avatar.JPEG">
  <p class="site-author-name" itemprop="name">Serein</p>
  <div class="site-description" itemprop="description">Crazy learning, crazy sharing.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Aricyq0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Aricyq0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ari.cyq@gmail.com" title="E-Mail → mailto:ari.cyq@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">[object Object]</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">122k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:51</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
