<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aricyq0.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文是斯坦福大学 cs193p 公开课程第08集的相关笔记。">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford-cs193p-08｜Animation">
<meta property="og:url" content="https://aricyq0.github.io/2025/01/20/Stanford-cs193p-08%EF%BD%9CAnimation/index.html">
<meta property="og:site_name" content="Serein">
<meta property="og:description" content="本文是斯坦福大学 cs193p 公开课程第08集的相关笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-01-20T03:32:19.000Z">
<meta property="article:modified_time" content="2025-01-20T03:32:19.013Z">
<meta property="article:author" content="Serein">
<meta property="article:tag" content="cs193p">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://aricyq0.github.io/2025/01/20/Stanford-cs193p-08%EF%BD%9CAnimation/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Stanford-cs193p-08｜Animation | Serein</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Serein" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Serein</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/aricyq0" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aricyq0.github.io/2025/01/20/Stanford-cs193p-08%EF%BD%9CAnimation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPEG">
      <meta itemprop="name" content="Serein">
      <meta itemprop="description" content="Crazy learning, crazy sharing.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serein">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Stanford-cs193p-08｜Animation
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-20 11:32:19" itemprop="dateCreated datePublished" datetime="2025-01-20T11:32:19+08:00">2025-01-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/code/swift/" itemprop="url" rel="index"><span itemprop="name">swift</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="far fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文是斯坦福大学 cs193p 公开课程第08集的相关笔记。</p>
<span id="more"></span>
<p>cs193p 课程介绍:</p>
<blockquote>
<p> The lectures for the Spring 2023 version of Stanford University’s course CS193p (Developing Applications for iOS using SwiftUI) were given in person but, unfortunately, were not video recorded. However, we did capture the laptop screen of the presentations and demos as well as the associated audio. You can watch these screen captures using the links below. You’ll also find links to supporting material that was distributed to students during the quarter (homework, demo code, etc.). </p>
</blockquote>
<p>cs193p 课程网址: [<a target="_blank" rel="noopener" href="https://cs193p.sites.stanford.edu/2023]">https://cs193p.sites.stanford.edu/2023]</a></p>
<h2 id="1-动画的基础概念"><a href="#1-动画的基础概念" class="headerlink" title="1. 动画的基础概念"></a>1. 动画的基础概念</h2><h3 id="1-1-动画的作用"><a href="#1-1-动画的作用" class="headerlink" title="1.1 动画的作用"></a>1.1 动画的作用</h3><ul>
<li>动画展示了已经发生的改变（即“最近的过去”）。</li>
<li>动画的核心是通过改变 <strong>视图修饰符（ViewModifiers）</strong> 或 <strong>形状（shapes）</strong> 来呈现效果。</li>
<li>视图的出现与消失（存在与否）也可以通过动画体现。</li>
</ul>
<h3 id="1-2-动画的前提条件"><a href="#1-2-动画的前提条件" class="headerlink" title="1.2 动画的前提条件"></a>1.2 动画的前提条件</h3><ul>
<li>动画仅适用于已经在用户界面中（ui）的视图。</li>
<li>如果视图是新加入的，它必须添加到一个已经存在的容器中（即“已在屏幕上的容器”，简称 ctaaos）。</li>
</ul>
<h2 id="2-动画的实现方式"><a href="#2-动画的实现方式" class="headerlink" title="2. 动画的实现方式"></a>2. 动画的实现方式</h2><h3 id="2-1-隐式动画（implicit-animation）"><a href="#2-1-隐式动画（implicit-animation）" class="headerlink" title="2.1 隐式动画（implicit animation）"></a>2.1 隐式动画（implicit animation）</h3><ul>
<li>隐式动画通过 <code>animation</code> 修饰符自动应用到视图的更改上。</li>
<li>示例：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    .opacity(isVisible <span class="operator">?</span> <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">    .animation(.easeInOut, value: isVisible)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>isVisible</code> 的变化会触发 <code>opacity</code> 的动画。</li>
<li>适用于“叶子视图”（独立于其他视图工作的非容器视图）。</li>
</ul>
</li>
</ul>
<h3 id="2-2-显式动画（explicit-animation）"><a href="#2-2-显式动画（explicit-animation）" class="headerlink" title="2.2 显式动画（explicit animation）"></a>2.2 显式动画（explicit animation）</h3><ul>
<li>显式动画需要通过 <code>withAnimation</code> 函数手动触发，适合需要在多个属性变化之间协调或精细可控制动画的场景</li>
<li>示例：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">ExplicitAnimationExample</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> rotationAngle <span class="operator">=</span> <span class="number">0.0</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">VStack</span> &#123;  </span><br><span class="line">               <span class="type">Image</span>(systemName: <span class="string">&quot;arrow.right.circle.fill&quot;</span>)  </span><br><span class="line">                   .font(.largeTitle)  </span><br><span class="line">                   .rotationEffect(.degrees(rotationAngle)) <span class="comment">// 应用旋转效果  </span></span><br><span class="line">               </span><br><span class="line">               <span class="type">Button</span>(<span class="string">&quot;Rotate&quot;</span>) &#123;  </span><br><span class="line">                   withAnimation(.spring()) &#123; <span class="comment">// 显式触发动画  </span></span><br><span class="line">                       rotationAngle <span class="operator">+=</span> <span class="number">90</span>  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           .padding()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">ExplicitAnimationExample_PreViews</span>: <span class="title class_ inherited__">PreViewProvider</span> &#123;  </span><br><span class="line">       <span class="keyword">static</span> <span class="keyword">var</span> preViews: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">ExplicitAnimationExample</span>()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>withAnimation</code> 包裹 <code>rotationAngle</code> 的更改，视图的旋转会以动画形式更新。</li>
<li>显示动画常用于多个视图同步动画，例如响应用户交互时。</li>
</ul>
</li>
</ul>
<h3 id="2-3-转场动画（transition）"><a href="#2-3-转场动画（transition）" class="headerlink" title="2.3 转场动画（transition）"></a>2.3 转场动画（transition）</h3><ul>
<li>转场动画定义视图<strong>出现（插入）或消失</strong>的方式。过渡只在视图添加到或从视图层次结构移除时生效，常用于切换视图或动态视图更新。必须配合条件渲染（如 <code>if</code> 或 <code>@state</code>）以及 <code>.transition</code> 使用。</li>
<li>本质上是两个视图修饰符的组合：<ul>
<li>一个修饰符定义视图插入时的初始状态。</li>
<li>另一个修饰符定义视图移除后的最终状态。</li>
</ul>
</li>
<li>示例：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> isfaceup &#123;</span><br><span class="line">    roundedrectangle(cornerradius: <span class="number">10</span>).transition(.scale)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    roundedrectangle(cornerradius: <span class="number">10</span>).transition(.opacity)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>当 <code>isfaceup</code> 变化时，视图会按定义的方式出现或消失。</li>
<li><strong>动画细节设置：</strong><ul>
<li>使用 <code>anytransition</code> 提供动画参数，例如：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.transition(anytransition.opacity.animation(.easeInOut))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-4-动画曲线（animation-curve）"><a href="#2-4-动画曲线（animation-curve）" class="headerlink" title="2.4 动画曲线（animation curve）"></a>2.4 动画曲线（animation curve）</h3><h2 id="动画曲线决定动画的播放节奏：-linear-：匀速动画。"><a href="#动画曲线决定动画的播放节奏：-linear-：匀速动画。" class="headerlink" title="动画曲线决定动画的播放节奏：- **linear**：匀速动画。"></a>动画曲线决定动画的播放节奏：<br>- **<code>linear</code>**：匀速动画。</h2><p>&#96;**：缓慢开始和结束，中间加速。</p>
<ul>
<li>**<code>spring</code>**：带弹性效果的动画，结尾会有“反弹”效果。</li>
</ul>
<p>示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;hello, animation!&quot;</span>)</span><br><span class="line">    .scaleeffect(scale)</span><br><span class="line">    .animation(.spring(response: <span class="number">0.5</span>, dampingFraction: <span class="number">0.7</span>), value: scale)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-5-区别对比：隐式动画、显示动画、过渡"><a href="#2-5-区别对比：隐式动画、显示动画、过渡" class="headerlink" title="2.5 区别对比：隐式动画、显示动画、过渡"></a>2.5 区别对比：隐式动画、显示动画、过渡</h3><table>
<thead>
<tr>
<th>特性</th>
<th><strong>隐式动画</strong></th>
<th><strong>显式动画</strong></th>
<th><strong>过渡（transition）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>触发方式</strong></td>
<td>使用 <code>.animation()</code> 修饰符绑定属性变化</td>
<td>使用 <code>withAnimation()</code> 包裹状态更改</td>
<td>配合 <code>if</code> 或条件渲染，使用 <code>.transition()</code> 定义</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>属性的值随状态变化自动应用动画</td>
<td>需要手动触发动画或协调多个动画时</td>
<td>视图插入或移除时应用动画</td>
</tr>
<tr>
<td><strong>控制力度</strong></td>
<td>简单绑定，适合单个属性变化</td>
<td>更灵活，可精确控制动画的执行</td>
<td>专注于视图的出现和消失</td>
</tr>
<tr>
<td><strong>是否绑定状态</strong></td>
<td>是</td>
<td>是</td>
<td>是（针对视图的插入和移除）</td>
</tr>
<tr>
<td><strong>示例</strong></td>
<td><code>.animation(.easeInOut(duration: 1))</code></td>
<td><code>withAnimation(.spring()) &#123; state.toggle() &#125;</code></td>
<td><code>.transition(.opacity)</code></td>
</tr>
</tbody></table>
<p><strong>示例：隐式动画、显式动画和过渡的结合</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">CombinedAnimationExample</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showRectangle <span class="operator">=</span> <span class="literal">false</span>  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> rotationAngle <span class="operator">=</span> <span class="number">0.0</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">VStack</span> &#123;  </span><br><span class="line">               <span class="keyword">if</span> showRectangle &#123;  </span><br><span class="line">                   <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25</span>)  </span><br><span class="line">                       .fill(<span class="type">Color</span>.blue)  </span><br><span class="line">                       .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)  </span><br><span class="line">                       .rotationEffect(.degrees(rotationAngle)) <span class="comment">// 动态旋转  </span></span><br><span class="line">                       .transition(.slide) <span class="comment">// 定义过渡效果  </span></span><br><span class="line">                       .animation(.easeInOut(duration: <span class="number">1</span>), value: rotationAngle) <span class="comment">// 隐式动画  </span></span><br><span class="line">               &#125;  </span><br><span class="line">   </span><br><span class="line">               <span class="type">Button</span>(<span class="string">&quot;Toggle Rectangle&quot;</span>) &#123;  </span><br><span class="line">                   withAnimation(.easeInOut) &#123; <span class="comment">// 显式触发动画  </span></span><br><span class="line">                       showRectangle.toggle()  </span><br><span class="line">                       rotationAngle <span class="operator">+=</span> <span class="number">180</span> <span class="comment">// 动态旋转  </span></span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           .padding()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">CombinedAnimationExample_PreViews</span>: <span class="title class_ inherited__">PreViewProvider</span> &#123;  </span><br><span class="line">       <span class="keyword">static</span> <span class="keyword">var</span> preViews: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">CombinedAnimationExample</span>()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>隐式动画</strong>：<code>animation</code> 修饰符绑定 <code>rotationAngle</code>，动态旋转时使用平滑动画。</li>
<li><strong>显式动画</strong>：<code>withAnimation</code> 控制视图的插入和移除。</li>
<li><strong>过渡</strong>：<code>.transition(.slide)</code>，定义视图插入或移除时的滑动效果。</li>
</ul>
<h2 id="3-动画的高级主题"><a href="#3-动画的高级主题" class="headerlink" title="3. 动画的高级主题"></a>3. 动画的高级主题</h2><h3 id="3-1-匹配几何效果（matched-geometry-effect）"><a href="#3-1-匹配几何效果（matched-geometry-effect）" class="headerlink" title="3.1 匹配几何效果（matched geometry effect）"></a>3.1 匹配几何效果（matched geometry effect）</h3><p><strong>定义</strong><br><code>matchedGeometryEffect</code> 是一种动画工具，用于在视图间切换时创建流畅的动画过渡效果。它可以将两个视图关联起来，swiftui 会自动为它们在几何空间上的变化添加动画效果。</p>
<p><strong>特点</strong></p>
<ul>
<li>通过在两个视图之间共享一个唯一的 <code>namespace</code> 标识，swiftui 知道它们是同一个元素在不同状态下的表示。</li>
<li>支持位置、大小、形状和样式等几何属性的动画。</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>动态切换视图或布局。</li>
<li>创建复杂的过渡动画，例如从网格到详细视图的切换。</li>
</ul>
<p><strong>示例：简单应用</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  matchegeometryexample.swift</span></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MatchedGeometryExample</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@Namespace</span> <span class="keyword">private</span> <span class="keyword">var</span> animationnamespace <span class="comment">// 创建 namespace</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isExpanded <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> isExpanded &#123;</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25</span>)</span><br><span class="line">                    .fill(<span class="type">Color</span>.blue)</span><br><span class="line">                    .matchedGeometryEffect(id: <span class="string">&quot;rectangle&quot;</span>, in: animationnamespace)</span><br><span class="line">                    .frame(width: <span class="number">300</span>, height: <span class="number">200</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25</span>)</span><br><span class="line">                    .fill(<span class="type">Color</span>.blue)</span><br><span class="line">                    .matchedGeometryEffect(id: <span class="string">&quot;rectangle&quot;</span>, in: animationnamespace)</span><br><span class="line">                    .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;toggle&quot;</span>) &#123;</span><br><span class="line">                withAnimation(.easeInOut) &#123;</span><br><span class="line">                    isExpanded.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="type">PreView</span> &#123;</span><br><span class="line">    <span class="type">MatchedGeometryExample</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>@namespace</code>**：创建一个动画范围（<code>namespace</code>）。</li>
<li>**<code>matchedGeometryEffect</code>**：将两个视图绑定到同一个 <code>id</code> 和 <code>namespace</code>，swiftui 会在它们之间自动插入动画过渡。</li>
<li><strong>效果</strong>：点击按钮后，矩形在大小和位置之间平滑过渡。</li>
</ul>
<h3 id="3-2-onappear"><a href="#3-2-onappear" class="headerlink" title="3.2 onappear"></a>3.2 onappear</h3><p><strong>定义</strong><br><code>onAppear</code> 是一个 swiftui 的视图修饰符，用于在视图第一次出现时触发特定的操作。</p>
<p><strong>特点：</strong></p>
<ul>
<li>适用于加载数据、初始化状态或启动动画。</li>
<li>每当视图进入屏幕时都会触发，包括首次加载和被隐藏视图重新显示。</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>视图初始化逻辑，例如从网络加载数据。</li>
<li>在视图出现时开始动画。</li>
</ul>
<p><strong>示例：加载数据</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">onappearexample</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@state</span> <span class="keyword">private</span> <span class="keyword">var</span> message <span class="operator">=</span> <span class="string">&quot;loading...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(message)</span><br><span class="line">            .onappear &#123;</span><br><span class="line">                <span class="comment">// 模拟数据加载</span></span><br><span class="line">                dispatchqueue.main.asyncafter(deadline: .now() <span class="operator">+</span> <span class="number">2</span>) &#123;</span><br><span class="line">                    message <span class="operator">=</span> <span class="string">&quot;data loaded!&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>onappear</code>**：在视图第一次出现在屏幕上时触发，更新 <code>message</code>。</li>
</ul>
<p><strong>示例：启动动画</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">AnimationOnAppear</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> scale <span class="operator">=</span> <span class="number">0.5</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">Circle</span>()  </span><br><span class="line">               .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)  </span><br><span class="line">               .scaleEffect(scale)  </span><br><span class="line">               .onAppear &#123;  </span><br><span class="line">                   withAnimation(.spring()) &#123;  </span><br><span class="line">                       scale <span class="operator">=</span> <span class="number">1.0</span>  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">AnimationOnAppear_PreViews</span>: <span class="title class_ inherited__">PreViewProvider</span> &#123;  </span><br><span class="line">       <span class="keyword">static</span> <span class="keyword">var</span> preViews: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">AnimationOnAppear</span>()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>效果</strong>：圆形从缩小状态平滑扩展到原始大小。</li>
</ul>
<h3 id="3-3-animatable-协议"><a href="#3-3-animatable-协议" class="headerlink" title="3.3 animatable 协议"></a>3.3 animatable 协议</h3><p><strong>定义</strong><br><code>animatable</code> 协议是 swiftui 的一个协议，用于创建自定义动画。符合 <code>animatable</code> 的类型需要定义一个 <code>animatableData</code> 属性，该属性会在动画过程中自动更新。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animatableData: type</span><br></pre></td></tr></table></figure>
<p><code>type</code> 必须实现 <code>vectorarithmetic</code> 协议，用于分割动画路径。</p>
<p><strong>特点</strong></p>
<ul>
<li>适合需要对自定义属性进行动画的场景。</li>
<li>通过 <code>animatabledata</code> 属性插入动画的插值逻辑。</li>
</ul>
<p><strong>使用场景</strong></p>
<ul>
<li>创建复杂的动画效果，例如路径变换、颜色渐变等。</li>
<li>对不直接支持动画的属性（如自定义绘图）添加动画。</li>
</ul>
<h4 id="3-3-1-animatabledate-动画数据的读写"><a href="#3-3-1-animatabledate-动画数据的读写" class="headerlink" title="3.3.1 animatabledate 动画数据的读写"></a>3.3.1 animatabledate 动画数据的读写</h4><ul>
<li><code>animatableData</code> 是一个<strong>读写属性</strong>：<ul>
<li><strong>写操作：</strong> 动画系统告诉 <code>shape</code> 或 <code>ViewModifier</code> 应该绘制的当前动画帧。</li>
<li><strong>读操作：</strong> 动画系统获取动画的起点和终点值。</li>
</ul>
</li>
<li>示例：<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Cardify</span>: <span class="title class_ inherited__">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> rotation: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> animatableData: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; rotation &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; rotation <span class="operator">=</span> newvalue &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: content) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 根据 rotation 值绘制视图</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-3-2-示例：路径变换动画"><a href="#3-3-2-示例：路径变换动画" class="headerlink" title="3.3.2 示例：路径变换动画"></a>3.3.2 示例：路径变换动画</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">AnimatableShape</span>: <span class="title class_ inherited__">Shape</span> &#123;  </span><br><span class="line">       <span class="keyword">var</span> animatableData: <span class="type">CGFloat</span> <span class="comment">// 定义可动画数据  </span></span><br><span class="line">   </span><br><span class="line">       <span class="keyword">func</span> <span class="title function_">path</span>(<span class="params">in</span> <span class="params">rect</span>: <span class="type">CGRect</span>) -&gt; <span class="type">Path</span> &#123;  </span><br><span class="line">           <span class="keyword">var</span> path <span class="operator">=</span> <span class="type">Path</span>()  </span><br><span class="line">           path.move(to: <span class="type">CGPoint</span>(x: rect.midX, y: rect.minY))  </span><br><span class="line">           path.addLine(to: <span class="type">CGPoint</span>(x: rect.maxX, y: rect.maxY))  </span><br><span class="line">           path.addLine(to: <span class="type">CGPoint</span>(x: rect.minX, y: rect.maxY))  </span><br><span class="line">           path.closeSubpath()  </span><br><span class="line">           <span class="keyword">return</span> path  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">AnimatableExample</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> value: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.0</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">AnimatableShape</span>(animatableData: value)  </span><br><span class="line">               .fill(<span class="type">Color</span>.blue)  </span><br><span class="line">               .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)  </span><br><span class="line">               .onAppear &#123;  </span><br><span class="line">                   withAnimation(.easeInOut(duration: <span class="number">2</span>)) &#123;  </span><br><span class="line">                       value <span class="operator">=</span> <span class="number">1.0</span> <span class="comment">// 触发动画  </span></span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>**<code>animatabledata</code>**：定义可动画的属性，在动画过程中插值变化。</li>
<li><strong>效果</strong>：<code>animatableshape</code> 会根据动画数据的变化动态更新其路径。</li>
</ul>
<h3 id="3-4-示例：综合使用-matchedGeometryEffect-和-animatable"><a href="#3-4-示例：综合使用-matchedGeometryEffect-和-animatable" class="headerlink" title="3.4 示例：综合使用 matchedGeometryEffect 和 animatable"></a>3.4 示例：综合使用 matchedGeometryEffect 和 animatable</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">CombinedExample</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="meta">@Namespace</span> <span class="keyword">private</span> <span class="keyword">var</span> namespace  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isExpanded <span class="operator">=</span> <span class="literal">false</span>  </span><br><span class="line">       <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> customValue: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.5</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">VStack</span> &#123;  </span><br><span class="line">               <span class="keyword">if</span> isExpanded &#123;  </span><br><span class="line">                   <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25</span>)  </span><br><span class="line">                       .fill(<span class="type">Color</span>.blue)  </span><br><span class="line">                       .matchedGeometryEffect(id: <span class="string">&quot;rectangle&quot;</span>, in: namespace)  </span><br><span class="line">                       .frame(width: <span class="number">300</span>, height: <span class="number">200</span>)  </span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                   <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25</span>)  </span><br><span class="line">                       .fill(<span class="type">Color</span>.blue)  </span><br><span class="line">                       .matchedGeometryEffect(id: <span class="string">&quot;rectangle&quot;</span>, in: namespace)  </span><br><span class="line">                       .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)  </span><br><span class="line">               &#125;  </span><br><span class="line">   </span><br><span class="line">               <span class="type">Slider</span>(value: <span class="variable">$customValue</span>)  </span><br><span class="line">                   .padding()  </span><br><span class="line">                   .onAppear &#123;  </span><br><span class="line">                       withAnimation(.easeInOut) &#123;  </span><br><span class="line">                           customValue <span class="operator">=</span> <span class="number">1.0</span>  </span><br><span class="line">                       &#125;  </span><br><span class="line">                   &#125;  </span><br><span class="line">   </span><br><span class="line">               <span class="type">Button</span>(<span class="string">&quot;Toggle&quot;</span>) &#123;  </span><br><span class="line">                   withAnimation(.spring()) &#123;  </span><br><span class="line">                       isExpanded.toggle()  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           .padding()  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>-<br>：用于矩形的大小和位置动画。</p>
<ul>
<li><strong>onAppear</strong>：在视图首次加载时触发滑块的动画。</li>
<li><strong>animatable</strong>：通过滑块调整自定义动画属性（如路径）。</li>
</ul>
<h3 id="4-demo"><a href="#4-demo" class="headerlink" title="4. demo"></a>4. demo</h3><h4 id="4-1-显式动画（shuffle-and-choosing-cards）"><a href="#4-1-显式动画（shuffle-and-choosing-cards）" class="headerlink" title="4.1 显式动画（shuffle and choosing cards）"></a>4.1 显式动画（shuffle and choosing cards）</h4><p><strong>shuffle cards</strong></p>
<p>shuffle 动画用于响应用户交互，此时更适合使用显示动画（<br>）。如果使用隐式动画，当用户频繁点击 <code>shuffle</code> 时，动画有时难以及时响应。</p>
<p>shuffle 时发生了什么变化？它对 <code>LazyVGrid</code> 视图中的 <code>ForEach</code> 中<br>s&#96; 的位置参数进行了重排序。</p>
<p><strong>choose cards</strong></p>
<p>choose card 的动画同样用于响应用户交互，适合使用显示动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGameView.swift  </span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="comment">// ...  </span></span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">VStack</span> &#123;  </span><br><span class="line">               cards  </span><br><span class="line">                   .foregroundColor(<span class="type">ViewModel</span>.color)  </span><br><span class="line">               <span class="type">Button</span>(<span class="string">&quot;Shuffle&quot;</span>) &#123;  </span><br><span class="line">                   <span class="comment">// 使用显式动画来处理用户交互：shuffle  </span></span><br><span class="line">                   withAnimation &#123;  </span><br><span class="line">                       <span class="type">ViewModel</span>.shuffle()  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           .padding()  </span><br><span class="line">       &#125;  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> cards: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">AspectVGrid</span>(items: <span class="type">ViewModel</span>.cards, aspectRatio: aspectRatio) &#123; card <span class="keyword">in</span>  </span><br><span class="line">               <span class="type">CardView</span>(card)  </span><br><span class="line">                   .aspectRatio(aspectRatio, contentMode: .fit)  </span><br><span class="line">                   .padding(<span class="number">8</span>)  </span><br><span class="line">                   .overlay(<span class="type">FlyingNumber</span>(number: scoreChange(causedBy: card)))  </span><br><span class="line">                   .onTapGesture &#123;  </span><br><span class="line">                       <span class="comment">// 使用显式动画处理用户交互：choose  </span></span><br><span class="line">                       withAnimation &#123;  </span><br><span class="line">                           <span class="type">ViewModel</span>.choose(card)  </span><br><span class="line">                       &#125;  </span><br><span class="line">                   &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-隐式动画（celebrating-a-match-）"><a href="#4-2-隐式动画（celebrating-a-match-）" class="headerlink" title="4.2 隐式动画（celebrating a match!）"></a>4.2 隐式动画（celebrating a match!）</h4><p>当卡片朝上时，我们希望给卡片设置一个庆祝动作。（不论用户是否点击该卡片，当卡片 <code>isMatched</code> 参数为 <code>true</code> 时，显示动画，与用户交互无关，shuffle 不会影响该动画）</p>
<p>我们希望简化动画的代码，为 <code>animation</code> 添加一个扩展 <code>spin</code> 动画。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  cardView.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI  </span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CardView</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">    <span class="comment">// ...  </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">        <span class="type">Pie</span>(endAngle: .degrees(<span class="number">240</span>))  </span><br><span class="line">            .opacity(<span class="type">Constants</span>.pie.opacity)  </span><br><span class="line">            .overlay(  </span><br><span class="line">                <span class="type">Text</span>(card.content)  </span><br><span class="line">                    .font(.system(size: <span class="type">Constants</span>.fontSize.largest))  </span><br><span class="line">                    .minimumScaleFactor(<span class="type">Constants</span>.fontSize.scaleFactor)  </span><br><span class="line">                    .multilineTextAlignment(.center)  </span><br><span class="line">                    .aspectRatio(<span class="number">1</span>, contentMode: .fit)  </span><br><span class="line">                    .padding(<span class="type">Constants</span>.pie.in<span class="keyword">set</span>)  </span><br><span class="line">                    .rotationEffect(.degrees(card.isMatched <span class="operator">?</span> <span class="number">360</span> : <span class="number">0</span>))  </span><br><span class="line">                    .animation(.spin(duration: <span class="number">1</span>), value: card.isMatched)  </span><br><span class="line">            )  </span><br><span class="line">            <span class="comment">// ...  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">// ...  </span></span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Animation</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">spin</span>(<span class="params">duration</span>: <span class="type">TimeInterval</span>) -&gt; <span class="type">Animation</span> &#123;  </span><br><span class="line">        .linear(duration: duration).repeatForever(autoreverses: <span class="literal">false</span>)  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-animate-Viewmodifier-flipping-the-cards-over"><a href="#4-3-animate-Viewmodifier-flipping-the-cards-over" class="headerlink" title="4.3 animate Viewmodifier (flipping the cards over)"></a>4.3 animate Viewmodifier (flipping the cards over)</h4><p>我们想要为卡片添加一个翻转动画，显然这与 <code>cardify</code> Viewmodifier 有关。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cardify.swift  </span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> SwiftUI  </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">struct</span> <span class="title class_">Cardify</span>: <span class="title class_ inherited__">ViewModifier</span>, <span class="title class_ inherited__">Animatable</span> &#123;  </span><br><span class="line">     <span class="comment">// isFaceUp 为 true 时，再次点击卡片不会有动画效果  </span></span><br><span class="line">     <span class="keyword">init</span>(<span class="params">isFaceUp</span>: <span class="type">Bool</span>) &#123;  </span><br><span class="line">         rotation <span class="operator">=</span> isFaceUp <span class="operator">?</span> <span class="number">0</span> : <span class="number">180</span>  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 令此处的 isFaceUp 为一个计算属性，确保在还未翻转 90 度前，看不到卡片内容  </span></span><br><span class="line">     <span class="keyword">var</span> isFaceUp: <span class="type">Bool</span> &#123;  </span><br><span class="line">         rotation <span class="operator">&lt;</span> <span class="number">90</span>  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="keyword">var</span> rotation: <span class="type">Double</span>  </span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 符合 Animatable 协议，需要 animatableData 可读写的计算属性  </span></span><br><span class="line">     <span class="keyword">var</span> animatableData: <span class="type">Double</span> &#123;  </span><br><span class="line">         <span class="keyword">get</span> &#123;  </span><br><span class="line">             <span class="keyword">return</span> rotation  </span><br><span class="line">         &#125;  </span><br><span class="line">         <span class="keyword">set</span> &#123;  </span><br><span class="line">             rotation <span class="operator">=</span> newValue  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">         <span class="type">ZStack</span> &#123;  </span><br><span class="line">             <span class="keyword">let</span> base <span class="operator">=</span> <span class="type">RoundedRectangle</span>(cornerRadius: <span class="type">Constants</span>.cornerRadius)  </span><br><span class="line">             base.strokeBorder(lineWidth: <span class="type">Constants</span>.lineWidth)  </span><br><span class="line">                 .background(base.fill(<span class="type">Color</span>.white))  </span><br><span class="line">                 .overlay(content)  </span><br><span class="line">                 .opacity(isFaceUp <span class="operator">?</span> <span class="number">1</span> : <span class="number">0</span>)  </span><br><span class="line">             base.fill()  </span><br><span class="line">                 .opacity(isFaceUp <span class="operator">?</span> <span class="number">0</span> : <span class="number">1</span>)  </span><br><span class="line">         &#125;  </span><br><span class="line">         .rotation3DEffect(.degrees(rotation), axis: (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>))  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="operator">...</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-取消不想要的动画（-animation-nil-）"><a href="#4-4-取消不想要的动画（-animation-nil-）" class="headerlink" title="4.4 取消不想要的动画（.animation(nil)）"></a>4.4 取消不想要的动画（.animation(nil)）</h4><p>接下来，要实现记分的功能，我们需要在 <code>memorygame</code> 中添加分数的计算属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MemorizeGame.swift  </span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> Foundation  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">MemoryGame</span>&lt;<span class="type">CardContent</span>&gt; <span class="keyword">where</span> <span class="type">CardContent</span>: <span class="type">Equatable</span> &#123;  </span><br><span class="line">       <span class="keyword">private(set)</span> <span class="keyword">var</span> cards: [<span class="type">Card</span>]  </span><br><span class="line">       <span class="keyword">private(set)</span> <span class="keyword">var</span> score <span class="operator">=</span> <span class="number">0</span>  </span><br><span class="line">       </span><br><span class="line">       <span class="keyword">init</span>(<span class="params">numberOfPairsOfCards</span>: <span class="type">Int</span>, <span class="params">cardContentFactory</span>: (<span class="type">Int</span>) -&gt; <span class="type">CardContent</span>) &#123;  </span><br><span class="line">           <span class="comment">// ...  </span></span><br><span class="line">       &#125;  </span><br><span class="line">   </span><br><span class="line">       <span class="comment">// ...  </span></span><br><span class="line">       <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">choose</span>(<span class="keyword">_</span> <span class="params">card</span>: <span class="type">Card</span>) &#123;  </span><br><span class="line">           <span class="keyword">if</span> <span class="keyword">let</span> chosenIndex <span class="operator">=</span> cards.firstIndex(where: &#123; <span class="variable">$0</span>.id <span class="operator">==</span> card.id &#125;) &#123;  </span><br><span class="line">               <span class="keyword">if</span> <span class="operator">!</span>cards[chosenIndex].isFaceUp <span class="operator">&amp;&amp;</span> <span class="operator">!</span>cards[chosenIndex].isMatched &#123;  </span><br><span class="line">                   <span class="keyword">if</span> <span class="keyword">let</span> potentialMatchIndex <span class="operator">=</span> indexOfTheOneAndOnlyFaceUpCard &#123;  </span><br><span class="line">                       <span class="keyword">if</span> cards[chosenIndex].content <span class="operator">==</span> cards[potentialMatchIndex].content &#123;  </span><br><span class="line">                           cards[chosenIndex].isMatched <span class="operator">=</span> <span class="literal">true</span>  </span><br><span class="line">                           cards[potentialMatchIndex].isMatched <span class="operator">=</span> <span class="literal">true</span>  </span><br><span class="line">                           score <span class="operator">+=</span> <span class="number">2</span>  </span><br><span class="line">                       &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                           <span class="keyword">if</span> cards[chosenIndex].hasBeenSeen &#123;  </span><br><span class="line">                               score <span class="operator">-=</span> <span class="number">1</span>  </span><br><span class="line">                           &#125;  </span><br><span class="line">                           <span class="keyword">if</span> cards[potentialMatchIndex].hasBeenSeen &#123;  </span><br><span class="line">                               score <span class="operator">-=</span> <span class="number">1</span>  </span><br><span class="line">                           &#125;  </span><br><span class="line">                       &#125;  </span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                       indexOfTheOneAndOnlyFaceUpCard <span class="operator">=</span> chosenIndex  </span><br><span class="line">                   &#125;  </span><br><span class="line">                   cards[chosenIndex].isFaceUp <span class="operator">=</span> <span class="literal">true</span>  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       </span><br><span class="line">       <span class="keyword">struct</span> <span class="title class_">Card</span>: <span class="title class_ inherited__">Identifiable</span>, <span class="title class_ inherited__">Equatable</span>, <span class="title class_ inherited__">CustomDebugStringConvertible</span> &#123;  </span><br><span class="line">           <span class="keyword">var</span> isFaceUp <span class="operator">=</span> <span class="literal">false</span> &#123;  </span><br><span class="line">               <span class="keyword">didSet</span> &#123;  </span><br><span class="line">                   <span class="keyword">if</span> oldValue <span class="operator">&amp;&amp;</span> <span class="operator">!</span>isFaceUp &#123;  </span><br><span class="line">                       hasBeenSeen <span class="operator">=</span> <span class="literal">true</span>  </span><br><span class="line">                   &#125;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           <span class="keyword">var</span> isMatched <span class="operator">=</span> <span class="literal">false</span>  </span><br><span class="line">           <span class="keyword">var</span> hasBeenSeen <span class="operator">=</span> <span class="literal">false</span>  </span><br><span class="line">           <span class="keyword">var</span> content: <span class="type">CardContent</span>  </span><br><span class="line">           </span><br><span class="line">           <span class="keyword">var</span> id: <span class="type">String</span>  </span><br><span class="line">           <span class="keyword">var</span> debugDescription: <span class="type">String</span> &#123;  </span><br><span class="line">               <span class="string">&quot;<span class="subst">\(id)</span>: <span class="subst">\(content)</span> <span class="subst">\(isFaceUp <span class="operator">?</span> <span class="string">&quot;up&quot;</span> : <span class="string">&quot;down&quot;</span>)</span> <span class="subst">\(isMatched <span class="operator">?</span> <span class="string">&quot;matched&quot;</span> : <span class="string">&quot;&quot;</span>)</span>&quot;</span>  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>在 <code>EmojiMemoryGameView</code> 中添加 <code>score</code> 视图并调整布局。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmojiMemoryGameView.swift  </span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> SwiftUI  </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line">       <span class="keyword">typealias</span> <span class="type">Card</span> <span class="operator">=</span> <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="comment">// @StateObject 意味着你不能和其他 View 共享 EmojiMemoryGame 这个对象  </span></span><br><span class="line">       <span class="comment">// @ObservedObject 表明你会观察这个变量，一旦这个变量发生改变，会重新渲染这个 UI 界面  </span></span><br><span class="line">       <span class="meta">@ObservedObject</span> <span class="keyword">var</span> <span class="type">ViewModel</span>: <span class="type">EmojiMemoryGame</span>  </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">let</span> aspectRatio: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">2</span> <span class="operator">/</span> <span class="number">3</span>  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">VStack</span> &#123;  </span><br><span class="line">               cards  </span><br><span class="line">                   .foregroundColor(<span class="type">ViewModel</span>.color)  </span><br><span class="line">               <span class="type">HStack</span> &#123;  </span><br><span class="line">                   score  </span><br><span class="line">                   <span class="type">Spacer</span>()  </span><br><span class="line">                   shuffle  </span><br><span class="line">               &#125;  </span><br><span class="line">               .font(.largeTitle)  </span><br><span class="line">           &#125;  </span><br><span class="line">           .padding()  </span><br><span class="line">       &#125;  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">var</span> score: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;Score: <span class="subst">\(ViewModel.score)</span>&quot;</span>)  </span><br><span class="line">               <span class="comment">// 取消 Score 视图的动画效果  </span></span><br><span class="line">               .animation(<span class="literal">nil</span>)  </span><br><span class="line">       &#125;  </span><br><span class="line">   </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">var</span> shuffle: <span class="keyword">some</span> <span class="type">View</span> &#123;  </span><br><span class="line">           <span class="type">Button</span>(<span class="string">&quot;Shuffle&quot;</span>) &#123;  </span><br><span class="line">               withAnimation &#123;  </span><br><span class="line">                   <span class="type">ViewModel</span>.shuffle()  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125;  </span><br><span class="line">       <span class="comment">// ...  </span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-onappear-动画（飞行的分数变化）"><a href="#4-5-onappear-动画（飞行的分数变化）" class="headerlink" title="4.5 onappear 动画（飞行的分数变化）"></a>4.5 onappear 动画（飞行的分数变化）</h4><p>这里希望每当出现得分，或者负分等不为 0 的情况时，会有飞行的记分动画。</p>
<p>我们添加一个 <code>FlyingNumber</code> 视图重叠在 <code>cards</code> 视图上，关于 <code>scoreChange</code> 函数会在下一节课继续。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  EmojiMemoryGameView.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EmojiMemoryGameView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Card</span> <span class="operator">=</span> <span class="type">MemoryGame</span>&lt;<span class="type">String</span>&gt;.<span class="type">Card</span></span><br><span class="line">	<span class="operator">...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cards: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">AspectVGrid</span>(items: <span class="type">ViewModel</span>.cards, aspectRatio: aspectRatio) &#123; card <span class="keyword">in</span></span><br><span class="line">            <span class="type">CardView</span>(card)</span><br><span class="line">                .aspectRatio(aspectRatio, contentMode: .fit)</span><br><span class="line">                .padding(<span class="number">8</span>)</span><br><span class="line">                .overlay(<span class="type">FlyingNumber</span>(number: scoreChange(causedBy: card)))</span><br><span class="line">                .onTapGesture &#123;</span><br><span class="line">                    withAnimation &#123;</span><br><span class="line">                        <span class="type">ViewModel</span>.choose(card)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">scoreChange</span>(<span class="params">causedBy</span> <span class="params">card</span>: <span class="type">Card</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#<span class="type">PreView</span> &#123;</span><br><span class="line">    <span class="type">EmojiMemoryGameView</span>(ViewModel: <span class="type">EmojiMemoryGame</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-课程预告-09"><a href="#5-课程预告-09" class="headerlink" title="5. 课程预告 09"></a>5. 课程预告 09</h2><ul>
<li>TimelineView （animating our pie-shaped countdown timer）</li>
<li>过渡动画（animating the arrival and departure of Views）</li>
<li>matchedGeometryEffect（dealing our cards out）</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>欣赏此文？求鼓励，求支持！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat.jpg" alt="Serein 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Serein 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
      <div>
     
       
<div class="my_post_copyright">
  <div style="text-align:center;color: #ccc;font-size:14px;">------ 版权声明 ------</div>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <p><span>原始链接:</span><a href="/2025/01/20/Stanford-cs193p-08%EF%BD%9CAnimation/" title="Stanford-cs193p-08｜Animation">https://aricyq0.github.io/2025/01/20/Stanford-cs193p-08｜Animation/</a>
    <button class="copy-button" style="cursor: pointer; margin-left: 6px; border: none; background: none;" title="点击复制文章链接">
      <i class="fa fa-clipboard" aria-label="复制"></i>
    </button>
    <span class="copy-success" style="margin-left: 5px; display: none; color: #999; font-size: 14px;">复制成功</span>
  </p>
  <p><span style="margin-right: 4px;">版权申明:</span>本博客所有文章除特别声明外，均采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a>许可协议。转载请保留原文链接及作者。</p>  
</div>
<script> 
  document.addEventListener('DOMContentLoaded', function() {
    var clipboard = new ClipboardJS('.copy-button', {
      text: function() {
        return window.location.origin + '/2025/01/20/Stanford-cs193p-08%EF%BD%9CAnimation/';
      }
    });
    
    clipboard.on('success', function(e) {
      var successTip = document.querySelector('.copy-success');
      successTip.style.display = 'inline';
      setTimeout(function() {
        successTip.style.display = 'none';
      }, 1000);
    });
  });
</script>

     
</div>
          
          <div class="post-tags">
              <a href="/tags/cs193p/" rel="tag"><i class="fa fa-tag"></i> cs193p</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/01/05/Stanford-cs193p-07%EF%BD%9CShape-ViewModifier-Constants/" rel="prev" title="Stanford cs193p 07｜Shape ViewModifier Constants">
      <i class="fa fa-chevron-left"></i> Stanford cs193p 07｜Shape ViewModifier Constants
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/01/20/Stanford-cs193p-09%EF%BD%9CAnimation-2/" rel="next" title="Stanford-cs193p-09｜Animation-2">
      Stanford-cs193p-09｜Animation-2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%8A%A8%E7%94%BB%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">1. 动画的基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%8A%A8%E7%94%BB%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">1.1 动画的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%8A%A8%E7%94%BB%E7%9A%84%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="nav-text">1.2 动画的前提条件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%8A%A8%E7%94%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="nav-text">2. 动画的实现方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E9%9A%90%E5%BC%8F%E5%8A%A8%E7%94%BB%EF%BC%88implicit-animation%EF%BC%89"><span class="nav-text">2.1 隐式动画（implicit animation）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%98%BE%E5%BC%8F%E5%8A%A8%E7%94%BB%EF%BC%88explicit-animation%EF%BC%89"><span class="nav-text">2.2 显式动画（explicit animation）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB%EF%BC%88transition%EF%BC%89"><span class="nav-text">2.3 转场动画（transition）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%8A%A8%E7%94%BB%E6%9B%B2%E7%BA%BF%EF%BC%88animation-curve%EF%BC%89"><span class="nav-text">2.4 动画曲线（animation curve）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB%E6%9B%B2%E7%BA%BF%E5%86%B3%E5%AE%9A%E5%8A%A8%E7%94%BB%E7%9A%84%E6%92%AD%E6%94%BE%E8%8A%82%E5%A5%8F%EF%BC%9A-linear-%EF%BC%9A%E5%8C%80%E9%80%9F%E5%8A%A8%E7%94%BB%E3%80%82"><span class="nav-text">动画曲线决定动画的播放节奏：- **linear**：匀速动画。</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%8C%BA%E5%88%AB%E5%AF%B9%E6%AF%94%EF%BC%9A%E9%9A%90%E5%BC%8F%E5%8A%A8%E7%94%BB%E3%80%81%E6%98%BE%E7%A4%BA%E5%8A%A8%E7%94%BB%E3%80%81%E8%BF%87%E6%B8%A1"><span class="nav-text">2.5 区别对比：隐式动画、显示动画、过渡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8A%A8%E7%94%BB%E7%9A%84%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98"><span class="nav-text">3. 动画的高级主题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%8C%B9%E9%85%8D%E5%87%A0%E4%BD%95%E6%95%88%E6%9E%9C%EF%BC%88matched-geometry-effect%EF%BC%89"><span class="nav-text">3.1 匹配几何效果（matched geometry effect）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-onappear"><span class="nav-text">3.2 onappear</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-animatable-%E5%8D%8F%E8%AE%AE"><span class="nav-text">3.3 animatable 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-animatabledate-%E5%8A%A8%E7%94%BB%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AF%BB%E5%86%99"><span class="nav-text">3.3.1 animatabledate 动画数据的读写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%B7%AF%E5%BE%84%E5%8F%98%E6%8D%A2%E5%8A%A8%E7%94%BB"><span class="nav-text">3.3.2 示例：路径变换动画</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E7%A4%BA%E4%BE%8B%EF%BC%9A%E7%BB%BC%E5%90%88%E4%BD%BF%E7%94%A8-matchedGeometryEffect-%E5%92%8C-animatable"><span class="nav-text">3.4 示例：综合使用 matchedGeometryEffect 和 animatable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-demo"><span class="nav-text">4. demo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E6%98%BE%E5%BC%8F%E5%8A%A8%E7%94%BB%EF%BC%88shuffle-and-choosing-cards%EF%BC%89"><span class="nav-text">4.1 显式动画（shuffle and choosing cards）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E9%9A%90%E5%BC%8F%E5%8A%A8%E7%94%BB%EF%BC%88celebrating-a-match-%EF%BC%89"><span class="nav-text">4.2 隐式动画（celebrating a match!）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-animate-Viewmodifier-flipping-the-cards-over"><span class="nav-text">4.3 animate Viewmodifier (flipping the cards over)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E5%8F%96%E6%B6%88%E4%B8%8D%E6%83%B3%E8%A6%81%E7%9A%84%E5%8A%A8%E7%94%BB%EF%BC%88-animation-nil-%EF%BC%89"><span class="nav-text">4.4 取消不想要的动画（.animation(nil)）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-onappear-%E5%8A%A8%E7%94%BB%EF%BC%88%E9%A3%9E%E8%A1%8C%E7%9A%84%E5%88%86%E6%95%B0%E5%8F%98%E5%8C%96%EF%BC%89"><span class="nav-text">4.5 onappear 动画（飞行的分数变化）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E8%AF%BE%E7%A8%8B%E9%A2%84%E5%91%8A-09"><span class="nav-text">5. 课程预告 09</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Serein"
      src="/uploads/avatar.JPEG">
  <p class="site-author-name" itemprop="name">Serein</p>
  <div class="site-description" itemprop="description">Crazy learning, crazy sharing.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Aricyq0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Aricyq0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ari.cyq@gmail.com" title="E-Mail → mailto:ari.cyq@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Serein</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">122k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:51</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
